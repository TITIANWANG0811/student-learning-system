# 端口配置说明

## 端口分配策略

为了避免与其他项目的端口冲突，初中生学习管理系统使用以下端口配置：

### 开发环境端口

| 服务 | 端口 | 说明 |
|------|------|------|
| 前端开发服务器 | 9003 | React开发服务器 |
| 后端API服务器 | 9002 | FastAPI后端服务 |
| PostgreSQL数据库 | 5432 | 数据库服务（默认端口） |
| Redis缓存 | 6379 | 缓存服务（默认端口） |

### 生产环境端口

| 服务 | 端口 | 说明 |
|------|------|------|
| Nginx反向代理 | 80/443 | HTTP/HTTPS访问 |
| 前端静态文件 | 9003 | 内部端口 |
| 后端API服务 | 9002 | 内部端口 |
| PostgreSQL | 5432 | 数据库服务 |
| Redis | 6379 | 缓存服务 |

## 端口冲突避免策略

### 1. 端口段分配
- **3000-3999**: 其他项目前端段（避免使用）
- **8000-8999**: 其他项目后端段（避免使用）
- **9000-9999**: 学习管理系统专用段

### 2. 当前项目使用
- **9003**: 前端开发服务器
- **9002**: 后端API服务器

### 3. 其他项目端口
- **3000**: 其他项目前端
- **8000**: 其他项目后端
- **8008**: 其他项目服务

## 配置修改记录

### 后端配置修改
- `backend/config.py`: 端口从8000改为9002
- CORS配置更新为支持9003端口

### 前端配置修改
- `frontend/package.json`: 启动脚本添加PORT=9003
- `frontend/src/services/api.ts`: API基础URL更新为9002端口

### 文档更新
- `README.md`: 访问地址更新
- `API文档.md`: API基础URL更新
- `部署指南.md`: 所有端口配置更新

## 启动验证

### 检查端口占用
```bash
# 检查端口是否被占用
lsof -i :9003
lsof -i :9002

# 或者使用netstat
netstat -tulpn | grep :9003
netstat -tulpn | grep :9002
```

### 启动服务
```bash
# 启动后端服务
cd backend
python main.py
# 应该显示: Uvicorn running on http://0.0.0.0:9002

# 启动前端服务
cd frontend
npm start
# 应该显示: Local: http://localhost:9003
```

### 访问验证
- 前端应用: http://localhost:9003
- 后端API: http://localhost:9002
- API文档: http://localhost:9002/docs

## 环境变量配置

### 前端环境变量
创建 `frontend/.env.local` 文件：
```
REACT_APP_API_URL=http://localhost:9002/api/v1
```

### 后端环境变量
在 `backend/.env` 文件中：
```
PORT=9002
HOST=0.0.0.0
```

## 故障排除

### 端口被占用
如果端口被占用，可以：
1. 停止占用端口的进程
2. 或者修改配置文件使用其他端口

### 跨域问题
确保CORS配置正确：
```python
allowed_origins: list = ["http://localhost:9003", "http://127.0.0.1:9003"]
```

### 防火墙问题
确保防火墙允许相应端口：
```bash
sudo ufw allow 9003
sudo ufw allow 9002
```

## 注意事项

1. **端口一致性**: 确保所有配置文件中的端口号一致
2. **环境隔离**: 开发、测试、生产环境使用不同端口
3. **文档同步**: 端口变更时及时更新相关文档
4. **团队协作**: 团队成员使用相同的端口配置

通过以上配置，可以确保初中生学习管理系统与其他项目并行运行，避免端口冲突问题。
